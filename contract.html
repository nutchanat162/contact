<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>


  <div class="password-overlay" id="passwordOverlay">
  <div class="password-modal">
    <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
    <input
      type="password"
      id="passwordInput"
      placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
      onkeydown="if(event.key==='Enter') checkPassword()"
    />
    <button onclick="checkPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <p id="passwordError" class="error-message"></p>
  </div>
</div>

  <h1>üìß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h1>

  <div class="filters">
    <div class="filter-group">
      <label>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
      <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£..." />
    </div>
    <div class="filter-group">
      <label>üè¢ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢</label>
      <select id="departmentFilter">
        <option value="">‡∏ó‡∏∏‡∏Å‡∏ù‡πà‡∏≤‡∏¢</option>
      </select>
    </div>
    <div class="filter-group">
      <label>üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</label>
      <select id="quickDeptDropdown" onchange="selectEntireDepartment(this.value)">
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å...</option>
      </select>
    </div>
    <div class="filter-group">
      <label>‚ö° ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
      <button class="btn btn-secondary" onclick="clearAllSelections()">‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    </div>
    <div class="filter-group">
      <label>‚úâÔ∏è ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ú‡∏ô‡∏Å</label>
      <button class="btn btn-primary" onclick="emailEntireDepartment()">üöÄ ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
  </div>

  <div class="email-builder">
    <h3>üì¨ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h3>
    <div class="selected-contacts" id="selectedContacts">
      <div style="color: rgba(255, 255, 255, 0.7); font-style: italic">
        ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•...
      </div>
    </div>
    <div class="email-actions">
      <button class="btn btn-primary" onclick="copyEmailList('to')">üìß Copy ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ TO</button>
      <button class="btn btn-secondary" onclick="copyEmailList('cc')">üìã Copy ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ CC</button>
      <button class="btn btn-secondary" onclick="openEmailClient()">üöÄ ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏µ‡πÄ‡∏°‡∏•</button>
    </div>
  </div>

  <div class="departments" id="departmentsContainer"></div>
  <div class="notification" id="notification"></div>

  <script>
    let contactsData = [];
    let selectedContacts = [];
    let filteredContacts = contactsData;

    async function loadContacts() {
      try {
        const res = await fetch("contacts.json");
        contactsData = await res.json();
        filteredContacts = contactsData;
        init();
      } catch (err) {
        console.error("‡πÇ‡∏´‡∏•‡∏î contacts.json ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", loadContacts);

    function init() {
      loadDepartmentFilter();
      populateQuickDropdown();
      renderContacts();
      setupEventListeners();
    }

    function loadDepartmentFilter() {
      const departments = [...new Set(contactsData.map((contact) => contact.department))];
      const filter = document.getElementById("departmentFilter");
      departments.forEach((dept) => {
        const option = document.createElement("option");
        option.value = dept;
        option.textContent = dept;
        filter.appendChild(option);
      });
    }

    function populateQuickDropdown() {
      const deptSelect = document.getElementById("quickDeptDropdown");
      const departments = [...new Set(contactsData.map(c => c.department))];
      departments.forEach((dept) => {
        const option = document.createElement("option");
        option.value = dept;
        option.textContent = dept;
        deptSelect.appendChild(option);
      });
    }

    function setupEventListeners() {
      document.getElementById("searchInput").addEventListener("input", filterContacts);
      document.getElementById("departmentFilter").addEventListener("change", filterContacts);
    }

    function filterContacts() {
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      const selectedDept = document.getElementById("departmentFilter").value;

      filteredContacts = contactsData.filter((contact) => {
        const matchesSearch =
          !searchTerm ||
          contact.name.toLowerCase().includes(searchTerm) ||
          contact.email.toLowerCase().includes(searchTerm) ||
          contact.phone.includes(searchTerm) ||
          contact.position.includes(searchTerm) ||
          contact.internal.includes(searchTerm);

        const matchesDept = !selectedDept || contact.department === selectedDept;

        return matchesSearch && matchesDept;
      });

      renderContacts();
    }

    function renderContacts() {
      const container = document.getElementById("departmentsContainer");
      const departments = {};

      filteredContacts.forEach((contact) => {
        if (!departments[contact.department]) {
          departments[contact.department] = [];
        }
        departments[contact.department].push(contact);
      });

      container.innerHTML = "";
      Object.keys(departments).forEach((deptName) => {
        const deptDiv = document.createElement("div");
        deptDiv.className = "department";

        const contactsHtml = departments[deptName]
          .map((contact) => {
            const isSelected = selectedContacts.some((sc) => sc.email === contact.email);
            return `
              <div class="contact-item ${isSelected ? "selected" : ""}" onclick="toggleContact('${contact.email}')">
                <div class="contact-header">
                  <div class="contact-name">${highlightSearch(contact.name)}</div>
                  <div class="contact-actions">
                    <button class="action-btn copy-btn" onclick="event.stopPropagation(); copyEmail('${contact.email}')" title="Copy ‡∏≠‡∏µ‡πÄ‡∏°‡∏•">üìã</button>
                    <button class="action-btn select-btn" title="${isSelected ? "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" : "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"}">${isSelected ? "‚úì" : "+"}</button>
                  </div>
                </div>
                <div class="contact-details">
                  <div class="detail-item"><span class="icon">üìß</span><span>${highlightSearch(contact.email)}</span></div>
                  <div class="detail-item"><span class="icon">üìû</span><span>${highlightSearch(contact.phone)}</span></div>
                  <div class="detail-item"><span class="icon">üòé</span><span>${highlightSearch(contact.position)}</span></div>
                  <div class="detail-item"><span class="icon">‚òéÔ∏è</span><span>‡∏ï‡πà‡∏≠‡πÉ‡∏ô ${highlightSearch(contact.internal)}</span></div>
                  <div class="detail-item"><span class="icon">üè¢</span><span>${contact.department}</span></div>
                </div>
              </div>`;
          })
          .join("");

        deptDiv.innerHTML = `
          <h3>${deptName}<span class="contact-count">${departments[deptName].length}</span></h3>
          ${contactsHtml}`;

        container.appendChild(deptDiv);
      });
    }

    function highlightSearch(text) {
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      if (!searchTerm) return text;
      const regex = new RegExp(`(${searchTerm})`, "gi");
      return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    function toggleContact(email) {
      const contact = contactsData.find((c) => c.email === email);
      const existingIndex = selectedContacts.findIndex((sc) => sc.email === email);
      if (existingIndex > -1) {
        selectedContacts.splice(existingIndex, 1);
      } else {
        selectedContacts.push(contact);
      }
      updateSelectedContactsDisplay();
      renderContacts();
    }

    function updateSelectedContactsDisplay() {
      const container = document.getElementById("selectedContacts");
      if (selectedContacts.length === 0) {
        container.innerHTML = '<div style="color: rgba(255,255,255,0.7); font-style: italic;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•...</div>';
        return;
      }
      const tagsHtml = selectedContacts.map(contact => `<div class="contact-tag"><span>${contact.name}</span><button class="remove" onclick="removeContact('${contact.email}')">√ó</button></div>`).join("");
      container.innerHTML = tagsHtml;
    }

    function removeContact(email) {
      selectedContacts = selectedContacts.filter((c) => c.email !== email);
      updateSelectedContactsDisplay();
      renderContacts();
    }

    function clearAllSelections() {
      selectedContacts = [];
      updateSelectedContactsDisplay();
      renderContacts();
    }

    function copyEmail(email) {
      navigator.clipboard.writeText(email).then(() => {
        showNotification(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${email}`);
      });
    }

    function copyEmailList(type) {
      if (selectedContacts.length === 0) {
        showNotification("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô", "error");
        return;
      }
      const emails = selectedContacts.map((c) => c.email).join(";");
      navigator.clipboard.writeText(emails).then(() => {
        showNotification(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ${type.toUpperCase()}: ${selectedContacts.length} ‡∏Ñ‡∏ô`);
      });
    }

    function openEmailClient() {
      if (selectedContacts.length === 0) {
        showNotification("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô", "error");
        return;
      }
      const emails = selectedContacts.map((c) => c.email).join(",");
      const subject = "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á";
      const body = "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ó‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö%0D%0A%0D%0A";
      window.location.href = `mailto:${emails}?subject=${encodeURIComponent(subject)}&body=${body}`;
    }

    function showNotification(message, type = "success") {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add("show");
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    function selectEntireDepartment(deptName) {
      if (!deptName) return;
      const contactsInDept = contactsData.filter(c => c.department === deptName && c.email);
      selectedContacts = [...contactsInDept];
      updateSelectedContactsDisplay();
      renderContacts();
      showNotification(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${contactsInDept.length} ‡∏Ñ‡∏ô ‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å ${deptName}`);
    }

    function emailEntireDepartment() {
      if (selectedContacts.length === 0) {
        showNotification("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏Å‡πà‡∏≠‡∏ô", "error");
        return;
      }
      const emails = selectedContacts.map((c) => c.email).join(",");
      const subject = "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á";
      const body = "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ó‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö%0D%0A%0D%0A";
      window.location.href = `mailto:${emails}?subject=${encodeURIComponent(subject)}&body=${body}`;
    }

    function checkPassword() {
  const correctPassword = "psucontact";
  const input = document.getElementById("passwordInput").value;
  const errorText = document.getElementById("passwordError");

  if (input === correctPassword) {
    document.getElementById("passwordOverlay").style.display = "none";
  } else {
    errorText.textContent = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
  }
}

  </script>
</body>

</html>
